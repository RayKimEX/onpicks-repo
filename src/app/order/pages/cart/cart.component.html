
<div class="cart">
  <ng-container *ngIf="{
    cartList:   (cartStore$ | async)?.cartList,
    cartInfo:   (cartStore$ | async)?.cartInfo,
    wishList:   (cartStore$ | async)?.wishList
  } as syncedData">
  <div class="row">
    <div class="cart__title h1-bold">쇼핑백</div>
      <div class="cart__section--title subtitle-1-bold">무료배송 상품</div>

      <div class="cart__delivery-free">
        <div class="cart__delivery-free-middle">
          <span class="cart__delivery-free-icon">
            <span class="cart__delivery-free-font u-bold u-color-white">F</span>
          </span>
          <span class="cart__delivery-free-spot-list">
            <ng-container [ngSwitch]="locale">
              <span *ngSwitchCase="'ko'" class="subtitle-1-bold" [ngStyle]="{ 'marginRight' : '0.4rem' }">뉴저지</span>
              <span *ngSwitchCase="'en'" class="subtitle-1-bold" [ngStyle]="{ 'marginRight' : '0.8rem' }">뉴저지</span>
              <span *ngSwitchCase="'zh'" class="subtitle-1-bold" [ngStyle]="{ 'marginRight' : '0.8rem' }">뉴저지</span>
            </ng-container>
            <span class="subtitle-1-bold u-color-green">무료배송</span>
          </span>
          <span class="cart__delivery-free-total-count subtitle-2-regular u-color-dark-grey">총 결제금액 <span class="subtitle-2-bold u-color-black">150000원</span></span>
        </div>
      </div>

      <onpicks-button class="cart__delivery-free-purchase" [type]="'white'" [size]="'big'" [width]="'16.1rem'">무료배송 구매하기</onpicks-button>

      <table class="cart__free-table">
        <tr>
          <td>
            <div class="cart__free-table--image">
              <img drLazyLoad src="" alt="">
            </div>

            <div class="cart__free-table--info">
              <div class="cart__free-table--info-title subtitle-3-bold">title</div>
              <div class="cart__free-table--info-name body-3-regular">알엑스바 리얼 푸드 프로틴 에너지바 믹스드 베리 52G / RxBar Real Food Protein Bars Mixed Berry 1.83OZ</div>
              <div class="cart__free-table--info-price subtitle-2-bold">40,900원</div>
            </div>

          </td>
          <td>
            <div class="cart__free-table--amount">
              <onpicks-list-active-button [isFixExtend]="true"></onpicks-list-active-button>
            </div>

            <div class="cart__free-table--add-to-wish">
              <a (click)="addToWishList()"
                class="subtitle-2-regular u-color-grey">
                다음에 구매하기
              </a>
            </div>
            <div class="cart__free-table--delete">
              <a
                (click)="deleteCart()"
                class="subtitle-2-regular u-color-grey">
                삭제하기
              </a>
            </div>
          </td>
          <td>
            <div class="cart__free-table--delivery-info">
              <div class="cart__free-table--delivery-info-image">
                <img src="http://img.onpicks.com/cart__table--info-N.png" alt="">
              </div>

              <div class="cart__free-table--delivery-info-where subtitle-2-regular"><span class="u-bold">뉴저지</span>출고&nbsp;·&nbsp;</div>
              <div class="cart__free-table--delivery-info-price subtitle-2-bold">무료배송</div>
              <div class="cart__free-table--delivery-info-description subtitle-2-regular u-color-dark-grey">뉴저지 단독 배송 상품으로 개별 배송료가 발생합니다.</div>
            </div>
          </td>
        </tr>
      </table>
    <div class="cart__section--title subtitle-1-bold">묶음 배송 상품</div>
    <div *ngFor="let item of syncedData?.cartInfo?.pack; index as packIndex">
      <ng-container *ngIf="item.items?.length !== 0">

        <div class="cart__delivery-multi">
          <div class="cart__delivery-multi-middle">
            <span class="cart__delivery-multi-icon subtitle-1-bold"
              [ngClass]=
                "[
                  (locationMap[item.location.slug].nickname === 'la')  ? 'icon-la' : '',
                  (locationMap[item.location.slug].nickname === 'new')  ? 'icon-new' : '',
                  (locationMap[item.location.slug].nickname === 'osaka')  ? 'icon-osaka' : '',
                  (locationMap[item.location.slug].nickname === 'gorgia')  ? 'icon-gorgia' : '',
                  (locationMap[item.location.slug].nickname === 'hong')  ? 'icon-hong' : ''
                ]">
            </span>
            <span class="cart__delivery-multi-spot-list">
              <ng-container [ngSwitch]="locale">
                <span *ngSwitchCase="'ko'" class="subtitle-1-bold" [ngStyle]="{ 'marginRight' : '0.4rem' }">{{item.location.name}}</span>
                <span *ngSwitchCase="'en'" class="subtitle-1-bold" [ngStyle]="{ 'marginRight' : '0.8rem' }">{{item.location.name}}</span>
                <span *ngSwitchCase="'zh'" class="subtitle-1-bold" [ngStyle]="{ 'marginRight' : '0.8rem' }">{{item.location.name}}</span>
              </ng-container>
              <span class="subtitle-1-regular">묶음배송</span>
            </span>
            <span class="cart__delivery-multi-total-count">
              <span class="subtitle-2-regular u-color-dark-grey">총 결제금액</span>
              <span class="subtitle-2-bold">{{item.subtotal | onpicksCurrency: 'KRW'}}</span>
            </span>
          </div>
        </div>

        <div class="cart__delivery-multi-purchase">
          <div class="cart__delivery-multi-purchase--remain">
            <div *ngIf="((item.free_shipping_threshold - (item.subtotal - item.shipping_fee)) > 0)" class="cart__delivery-multi-purchase--remain-description subtitle-2-regular">{{item.location.name}} 무료배송까지 {{item.free_shipping_threshold - (item.subtotal - item.shipping_fee) | onpicksCurrency:'KRW'}} 남았습니다</div>
            <div *ngIf="!((item.free_shipping_threshold - (item.subtotal - item.shipping_fee)) > 0)"class="cart__delivery-multi-purchase--remain-description subtitle-2-bold">{{item.location.name}} 무료배송 조건이 충족되었습니다</div>
            <ui-progressive-bar [progressWidth]="
            ((((item.subtotal - item.shipping_fee) / item.free_shipping_threshold) * 100) > 100 ? 100 :  ((((item.subtotal - item.shipping_fee) / item.free_shipping_threshold) * 100))) + '%'"></ui-progressive-bar>
          </div>

          <onpicks-button
            (click)="setCheckoutList(item.items)"
            class="cart__delivery-multi-purchase--btn"
            [type]="'white'"
            [size]="'big'"
            [width]="'16.1rem'"
          >묶음배송 구매하기</onpicks-button>
        </div>
      </ng-container>
      <table class="cart__multi-table">
        <tr *ngFor="let itemChild of item.items; index as itemIndex">
          <td>
            <div class="cart__multi-table--image">
              <img src="{{itemChild.thumbnail}}" alt="">
            </div>
            <div class="cart__multi-table--info">
              <div class="cart__multi-table--info-title subtitle-3-bold">{{itemChild.brand}}</div>
              <div class="cart__multi-table--info-name subtitle-3-regular">{{itemChild.title}}</div>
              <div class="cart__multi-table--info-price subtitle-2-bold">{{itemChild.sale_price | onpicksCurrency: 'KRW'}}</div>
            </div>
          </td>
          <td>
            <div class="cart__multi-table--amount">
              <onpicks-list-active-button
                (addEvent)="addToCart(syncedData?.cartList[itemChild.product]?.quantity, itemChild.product)"
                (subtractEvent)="subtractFromCart(syncedData?.cartList[itemChild.product]?.quantity, itemChild.product)"
                [amount]="syncedData?.cartList[itemChild.product]?.quantity"
                [isFixExtend]="true">
              </onpicks-list-active-button>
            </div>

            <div class="cart__multi-table--add-to-wish">
              <a
                (click)="addToWishList(itemChild.product)"
                class="subtitle-2-regular u-color-grey">
                다음에 구매하기
              </a>
            </div>
            <div class="cart__multi-table--delete subtitle-2-regular u-color-grey">
              <a
                (click)="deleteCart(itemChild.product, itemIndex, packIndex, 'pack')"
                class="subtitle-2-regular u-color-grey">
                삭제하기
              </a>
            </div>
          </td>
          <td *ngIf="itemIndex === 0" [attr.rowspan]="item?.items.length">
            <div class="cart__multi-table--delivery-info">
              <div class="cart__multi-table--delivery-info-price" [ngSwitch]="(item.subtotal - item.shipping_fee) < item.free_shipping_threshold">
                <span class="subtitle-2-regular" *ngSwitchCase="true">{{item.shipping_fee | onpicksCurrency: 'KRW'}}</span>
                <span class="subtitle-2-bold u-color-green" *ngSwitchDefault>무료</span>
              </div>
              <div class="cart__multi-table--delivery-info-description subtitle-2-regular u-color-dark-grey">뉴저지 단독 배송 상품 {{item.free_shipping_threshold | onpicksCurrency: 'KRW'}} 이상 주문시 무료 배송</div>
            </div>
          </td>
        </tr>
      </table>
    </div>
    <onpicks-sort-box
      (click)="toggleWishList(f)"
      class="cart__load-purchase-thing"
      [fontSize]="'1.4rem'"
      [showBox]="false"
      [sortList]="[{ title : '다음에 구매할 물건 불러오기', value : 0 }]">
    </onpicks-sort-box>
    <div #f class="cart__wishlist">
      <div class="cart__wishlist--title h1-bold">다음에 구매하기</div>
      <table class="cart__wishlist-table">
        <tr *ngFor="let item of syncedData?.wishList; index as i">
          <td>
            <div class="cart__wishlist-table--image">
              <img drLazyLoad src="{{item.thumbnail}}" alt="">
            </div>

            <div class="cart__wishlist-table--info">
              <div class="cart__wishlist-table--info-title subtitle-3-bold">{{item.brand}}</div>
              <div class="cart__wishlist-table--info-name subtitle-3-regular">{{item.title}}</div>
              <div class="cart__wishlist-table--info-price subtitle-2-bold">{{item.price | onpicksCurrency: 'KRW'}}</div>
            </div>
          </td>
          <td>
            <div class="cart__wishlist-table--delivery-info">
              <div class="cart__wishlist-table--delivery-info-image">
                <img src="http://img.onpicks.com/cart__table--info-N.png" alt="">
              </div>

              <div class="cart__wishlist-table--delivery-info-where subtitle-2-regular"><span class="u-bold">{{item.location.name}}</span>출고&nbsp;·</div>
              <div class="cart__wishlist-table--delivery-info-price subtitle-2-bold">묶음배송</div>
              <div class="cart__wishlist-table--delivery-info-description subtitle-2-regular u-color-dark-grey">뉴저지 묶음배송 상품으로 {{item.location.free_shipping_threshold | onpicksCurrency: 'KRW'}} 이상 주문시 배송료 무료</div>
            </div>
          </td>
          <td>
            <button class="btn btn--white btn--small cart__wishlist-table--btn"
                    [routerLink]="'/shops/p/' + item.product">옵션 선택하기</button>
            <button class="btn btn--white btn--small cart__wishlist-table--btn"
                    (click)="deleteWishList(item.id, i)">삭제하기</button>
          </td>
        </tr>
      </table>
    </div>


    <div class="cart__payment">
      <div class="cart__section--title h1-bold">결제금액</div>
      <table class="cart__payment-table">
        <tr class="subtitle-2-regular u-color-dark-grey">
          <td>총 상품금액</td>
          <td></td>
          <td>배송비</td>
          <td></td>
          <td>할인금액</td>
          <td></td>
          <td>총 결제금액</td>
        </tr>
        <tr class="h1-bold">
          <td>{{syncedData?.cartInfo?.total?.total_items | onpicksCurrency: 'KRW'}}</td>
          <td>+</td>
          <td [ngClass]="{ 'u-color-green' : syncedData?.cartInfo?.total?.total_shipping_fee == 0}">{{syncedData?.cartInfo?.total?.total_shipping_fee === 0 ? '무료' : (syncedData?.cartInfo?.total?.total_shipping_fee  | onpicksCurrency: 'KRW')}}</td>
          <td>-</td>
          <td>{{syncedData?.cartInfo?.total?.total_discounts | onpicksCurrency: 'KRW'}}</td>
          <td>=</td>
          <td>{{syncedData?.cartInfo?.total?.total_items + syncedData?.cartInfo?.total?.total_shipping_fee | onpicksCurrency : 'KRW'}}</td>
        </tr>
      </table>
    </div>
    <onpicks-button
      class="cart__btn--shopping"
      [type]="'white'"
      [size]="'big'"
      [width]="'13.4rem'">계속 쇼핑하기
    </onpicks-button>
    <onpicks-button
      (click)="setCheckoutList(denormalizr(cartStore.cartList))"
      class="cart__btn--shopping"
      [type]="'black'"
      [size]="'big'"
      [width]="'13.4rem'">전체 구매하기
    </onpicks-button>
    </div>
  </ng-container>

  <ui-mini-list [setTitle]="'이 상품과 함께 구매한 상품'"></ui-mini-list>
</div>

